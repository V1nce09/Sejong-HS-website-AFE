<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>세종고 통합 포털</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body data-initial-date="{{ date }}" data-initial-grade="{{ grade }}" data-initial-classroom="{{ classroom }}">
<div class="container">

    {% if session.get('user') %}
    <!-- 프로필: 이름 + 학번(또는 관리자) + 동작 메뉴 -->
    <div class="profile-mini" role="note" aria-label="사용자 프로필">
      <div class="avatar">{{ (session.get('display_name') or session.get('user'))[0] | upper }}</div>
      <div class="profile-text">
        <div class="profile-name">{{ session.get('display_name') or session.get('user') }}</div>
        <div class="profile-sub">
          {% if session.get('user') == 'admin' %}
            관리자
          {% else %}
            학번: {{ session.get('student_no') or '등록안됨' }}
          {% endif %}
        </div>
      </div>

      <!-- 점 버튼 및 드롭다운 -->
      <div class="profile-actions" aria-hidden="true">
        <button class="dots-btn" aria-label="메뉴" type="button">⋯</button>
        <div class="profile-dropdown" aria-hidden="true">
          <a href="{{ url_for('logout') }}" class="dropdown-item">로그아웃</a>
        </div>
      </div>
    </div>
    {% else %}
    <!-- 로그인 버튼 -->
    <a href="{{ url_for('login') }}" class="bottom-left-auth-btn">로그인</a>
    {% endif %}

    <!-- 좌측 패널 -->
    <aside class="sidebar">
      <h3 style="color:#fff;margin:0 0 14px 0;">반 선택</h3>
      <form id="queryForm">
        <label style="color:#fff;font-weight:600;">날짜
          <input type="date" id="date" name="date" style="margin-top:6px;" value="{{ date[:4] + '-' + date[4:6] + '-' + date[6:] if date }}">
        </label>

        <label style="color:#fff;font-weight:600;">학년
          <input type="number" id="grade" name="grade" min="1" max="3" value="{{ grade }}">
        </label>

        <label style="color:#fff;font-weight:600;">반
          <input type="number" id="classroom" name="classroom" min="1" max="15" value="{{ classroom }}">
        </label>

        <button type="submit" style="margin-top:10px;background:#e67e22;color:#fff;padding:10px;border:none;border-radius:6px;cursor:pointer;width:100%;">조회</button>
      </form>
    </aside>

    <!-- 중앙 -->
    <main class="timetable-section">
      <div id="timetable-title-container"><h2 style="margin-top:0;"></h2></div>
      <p class="placeholder" id="timetable-loading">시간표를 불러오는 중...</p>
      <div id="timetable-data-container"></div>
    </main>

    <!-- 우측 -->
    <aside class="meal-panel">
      <h2 id="meal-date-display" style="margin-top:0;"></h2> <!-- 날짜를 표시할 새로운 요소 -->
      <p class="placeholder" id="meal-loading">급식 정보를 불러오는 중...</p>
      <div id="meal-content"></div>
    </aside>
</div>

<script src="{{ url_for('static', filename='js/main.js') }}" defer></script>
</body>
</html>